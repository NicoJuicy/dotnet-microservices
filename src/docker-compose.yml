version: '3.5'
services:
  ordering:
    image: 'ordering:latest'
    build:
      context: .
      dockerfile: Dockerfile.ordering
    container_name: ordering
    depends_on:
      - "consul"
    networks:
      microservices: null    
  deliveries:
    image: 'deliveries:latest'
    build:
      context: .
      dockerfile: Dockerfile.deliveries
    container_name: deliveries
    depends_on:
      - "consul"
    networks:
      microservices: null
  api.gateway:
    image: 'apigateway:latest'
    build:
      context: .
      dockerfile: Dockerfile.apigateway
    container_name: apigateway
    networks:
      microservices: null
  consul:
    image: 'consul:latest'
    command: consul agent -dev -log-level=warn -ui -client=0.0.0.0
    hostname: consul
    container_name: consul    
    networks:
      microservices: null
  prometheus:
    image: prom/prometheus
    container_name: prometheus
    depends_on:
      - "consul"    
    networks:
      microservices: null
  grafana:
    image: grafana/grafana
    container_name: grafana
    depends_on:
      - "prometheus"
    networks:
      microservices: null
networks:
  microservices:
    driver: bridge
volumes:
  prometheus:
    driver: local
  grafana:
    driver: local
